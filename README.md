# Инструкция по настройке и использованию Telegram бота для Google Таблиц

Данный бот предназначен для автоматического выделения ячеек в Google Таблице на основе введенных номеров строк и номеров ТК (трекинг-кодов).

---

## 1. Настройка Google Apps Script

1.  Откройте вашу Google Таблицу. 
2.  Перейдите в меню **Расширения** -> **Apps Script**.
3.  Скопируйте содержимое файла `google-apps-script.js` из этого проекта и вставьте его в редактор скриптов.
4.  Нажмите кнопку **Сохранить** (иконка дискеты).
5.  Нажмите кнопку **Начать развертывание** (Deploy) -> **Новое развертывание** (New Deployment).
6.  Выберите тип: **Веб-приложение** (Web App).
7.  Настройте параметры:
    *   **Описание**: Любое (например, "Бот для выделения").
    *   **Запуск от имени**: Я (Me).
    *   **Кто имеет доступ**: Все (Anyone). **Это критически важно!**
8.  Нажмите **Развернуть**. Google может запросить разрешение доступа — предоставьте его.
9.  Скопируйте полученный **URL веб-приложения**.

---

## 2. Настройка бота в Replit

1.  В проекте Replit откройте файл `server/bot.ts`.
2.  Найдите **строку 7** и замените значение переменной `APPS_SCRIPT_URL` на URL, который вы скопировали на предыдущем шаге.
    *   Пример: `const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/.../exec';`
3.  Сохраните файл. Бот автоматически перезагрузится.
4.  Убедитесь, что в секретах (Secrets) Replit установлен `TELEGRAM_BOT_TOKEN`.

---

## 3. Как пользоваться ботом

Бот работает в режиме пошагового диалога:

1.  Найдите бота в Telegram и отправьте команду `/start`.
2.  Бот попросит ввести **номер строки**.
    *   Можно вводить просто число: `118`
    *   Можно вводить с буквой: `A118`
3.  Затем бот попросит ввести **номера ТК**.
    *   Введите их через запятую: `203, 227, 230`
4.  После ввода бот отправит запрос в Google Таблицу. Если всё настроено верно, ячейки в указанной строке под соответствующими номерами ТК окрасятся в зеленый цвет.

---

## 4. Решение проблем

*   **Ошибка 409 (Conflict)**: Возникает, если запущены две копии бота. Просто подождите 10-15 секунд и нажмите кнопку **Run** в Replit. Я добавил механизм автоматического сброса сессии.
*   **Ячейки не красятся**:
    *   Проверьте, что в Google Apps Script правильно указан доступ "Anyone".
    *   Убедитесь, что номера ТК в первой строке таблицы в точности совпадают с тем, что вы пишете в боте.
    *   Проверьте **Dashboard** в приложении — там отображаются ответы от Google.
